{% extends "base.html" %}
{% load static %}
{% block title %} <title>Fantamarconi | TIMELINE</title> {% endblock %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/loader.css' %}">
{% endblock %}

{% block content %}
<div class="row" id='select-referent'>
    <div class='justify-content-md-center col-sm-10 offset-sm-1'>
        <h4>Seleziona referente</h4>
        <form method="get">
            <div class="col-sm-12">
                <div class="input-group">
                    <span class="input-group-addon col-sm-3">Nome</span>
                    <input class="form-control" id="name-referent-input" type="text" value=""/>
                </div>
                <br />
                <div class="input-group">
                    <span class="input-group-addon col-sm-3">Cognome</span>
                    <input class="form-control" id="surname-referent-input" type="text" value=""/>
                </div>
            </div>
            <br  />
            <button class="btn btn-warning col-sm-6" type="button" onclick='select_referent()'>SELEZIONA</button>
        </form>
        <br />
        <!-- Ricarica tutti i processi -->
        <form method="get">
            <button class="btn btn-primary col-sm-6" type="submit">VEDI TUTTI</button>
        </form>

        <br />
        <div class="spinner" id='spinner'>
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>

    </div>
</div>

{% endblock %}

{% block script %}
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="{% static 'js/timeline.js' %}"></script>
    <script>
        var timeline_data;
        var person_selected;

        function load_data() {
            first_name = $('#name-referent-input').val();
            last_name = $('#surname-referent-input').val();

            person_selected = first_name

            if (last_name !== "" ) {
                person_selected += ' ' + last_name;
            }

        	$.get("{% url 'get_timeline' %}",
                {
                    first_name: first_name,
                    last_name: last_name,
                    dataType: "json"
                }
                ).done(function(data) {
                    if (data.error !== undefined & data.error !== "") {
                        $('#content').append("<div class='row' id='message-row'><h4 class='col-sm-12 text-warning text-center'>Attenzione: "+data.error+"</h4></div>");
                    } else {
                        timeline_data = data;
                        google.charts.load('current', {packages:["timeline"]});
                        google.charts.setOnLoadCallback(draw_timeline);
                    }
                })
                .fail(function() {
                    $('#content').append("<div class='row' id='message-row'><h4 class='col-sm-12 text-danger text-center'>Errore durante il caricamento dei dati. Riprovare o contattare l'amministratore,</h4></div>");
        	})
            .always( function() {
                $('#spinner').remove();
            });
        }

        $(document).ready( function() {
            load_data();
        });
    </script>
{% endblock %}
